# Django tutorial

django 프레임워크는 가상환경에서 사용하는 것을 추천한다. django 버전관리 때문!  

## django 프로젝트 생성  

django 프로젝트를 생성하기 위해서 프로젝트를 생성할 디렉터리에서 다음과 같이 명령어를 입력한다.  

```
django-admin startproject 프로젝트명
```  

생성된 프로젝트의 구조를 살펴보자면

- manage.py : 프로젝트와 상호작용하기 위한 커맨드 라인 유틸리티  

생성된 프로젝트와 같은 이름의 패키지가 생성되어 있다. 해당 패키지 내부를 보면  
- settings.py : 프로젝트의 환경 및 구성
- urls.py : URL 패턴 관리 (해당 프로젝트에 생성된 앱에 접근하기 위한 URL 패턴)
- asgi.py : ASGI 호환 웹 서버 진입점
- wsgi.py : WSGI 호환 웹 서버 진입점

## django 프로젝트 내부에 앱 생성  

프로젝트에는 앱을 생성하여 독립적으로 관리할 수 있다. 앱 생성은 manage.py 를 통해 진행한다. (앞으로도 많이 쓸 예정)  

```
python manage.py startapp 앱명
```  

앱을 생성하면 다음과 같이 구성되어 있다.  
- admin.py : 관리자 페이지를 관리한다. 이곳에서 모델을 관리자 페이지에 등록 및 커스텀이 가능하다.
- app.py  
- models.py : 해당 앱에 포함될 테이블을 설계하는 곳이다.
- test.py  
- urls.py (따로 생성해야 한다.) : 뷰에 매핑할 url 패턴을 작성하는 곳이다.
- views.py : 해당 앱의 url 패턴에 매핑될 뷰들을 작성하는 곳이다. 여기서 템플릿을 사용해 뷰(로직)로부터 디자인을 분리할 수 있다.
- migrations/ : python manage.py makemigrations [앱명] 을 통해 테이블의 변동사항을 만들고, python manage.py migrate [앱명]을 통해 변동사항을 commit한다.

### [참고] 관리자 페이지 커스텀
```
from django.contrib import admin

class SIGPostTable(admin.ModelAdmin):
    list_display = (
        'sig_cd',
        'sig_eng_nm',
        'sig_kor_nm',
    )

    list_display_links = (
        'sig_cd',
    )
    
admin.site.register(SIG,SIGPostTable)    
```  

위 코드처럼 단순히 register를 하는게 아니라 커스텀된 형태를 두번째 인자로 줄 수 있다.  
list_display는 어떤 필드가 보여질 것인지,  
list_display_links는 어떤 필드를 클릭하면 세부사항 링크를 걸지 선택할 수 있다.  
이 밖에도 다른 속성들이 많으니 직접 검색해보면 된다.  

### [참고] Migration
```
python manage.py makemigration [앱명]
```  
명령어를 실행하면 다음과 같이 마이그레이션 파일이 생성된다.  

e.g)  
```
# Generated by Django 3.1.3 on 2020-11-26 01:18

from django.db import migrations, models


class Migration(migrations.Migration):

    dependencies = [
        ('dbmanage', '0002_delete_info'),
    ]

    operations = [
        migrations.CreateModel(
            name='Info',
            fields=[
                ('receipt_no', models.IntegerField(primary_key=True, serialize=False)),
                ('pipe_length', models.FloatField()),
                ('exploration', models.FloatField()),
                ('measurement', models.FloatField()),
                ('non_exploration', models.FloatField()),
                ('map_scale', models.CharField(max_length=1000)),
            ],
        ),
    ]

```  

operations를 확인해보면 해당 마이그레이션 파일에서 어떤 연산을 수행할지 정보가 적혀져 있다. 다음의 코드에서는 새로운 모델(테이블)을 생성하는 CreateModel() 메소드가 사용되었다. 이 밖에도 DeleteModel(), Addfield()등 다양한 메소드들이 있으니 검색해보면 된다.  

Tip)  
```
python manage.py makemigrations --empty [앱명]
```  
--empty 옵션을 주게되면 operations가 비어있는 마이그레이션 파일이 생성된다. 여기다가 직접 operations를 작성하여 migrate를 해도된다. (능력이 된다면 ㅋ)  

## view 작성  

## URLConf 설정  

## DB 설정  

## django 프로젝트에 앱 등록  

## 앱 내부에 모델 설계  

## 관리자 계정 생성  

## 서버 구동  

## 관리자 페이지에 모델 등록  
